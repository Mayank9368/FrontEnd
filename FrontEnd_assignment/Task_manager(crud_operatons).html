<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Task Manager â€” CRUD + Local Storage</title>
<style>
:root{
  --bg:#0f1724;
  --card:#0b1220;
  --muted:#94a3b8;
  --accent:#60a5fa;
  --success:#34d399;
  --danger:#fb7185;
  --glass: rgba(255,255,255,0.03);
  --radius:14px;
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:
    linear-gradient(180deg, rgba(9,11,15,1) 0%, rgba(11,15,22,1) 50%),
    radial-gradient(600px 300px at 10% 10%, rgba(96,165,250,0.06), transparent 10%),
    var(--bg);
  color:#e6eef8;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:28px;
}
.app{
  width:960px;
  max-width:96vw;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:20px;
  box-shadow:0 12px 40px rgba(2,6,23,0.6);
  padding:22px;
  display:grid;
  grid-template-columns: 360px 1fr;
  gap:20px;
  min-height:520px;
}
.brand{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:18px;
}
.logo{
  width:48px;
  height:48px;
  border-radius:10px;
  background:linear-gradient(135deg,var(--accent),#7c3aed);
  display:grid;
  place-items:center;
  font-weight:700;
  color:#061226;
  box-shadow:0 6px 18px rgba(96,165,250,0.08), inset 0 -6px 12px rgba(255,255,255,0.02);
}
.title{
  font-size:18px;
  line-height:1;
  font-weight:600;
}
.subtitle{
  color:var(--muted);
  font-size:13px;
  margin-top:2px;
}
.panel{
  background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006));
  border-radius:12px;
  padding:16px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
}
.left{
  display:flex;
  flex-direction:column;
  gap:14px;
}
.form-row{
  display:flex;
  gap:8px;
  align-items:center;
}
.input, .filter{
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.04);
  background:var(--glass);
  color:inherit;
  outline:none;
  font-size:14px;
}
.input:focus, .filter:focus{box-shadow:0 4px 18px rgba(96,165,250,0.08);border-color:rgba(96,165,250,0.14)}
.btn{
  padding:10px 12px;
  border-radius:10px;
  cursor:pointer;
  border:0;
  font-weight:600;
  background:linear-gradient(180deg,var(--accent),#3b82f6);
  color:#061226;
  box-shadow:0 8px 28px rgba(96,165,250,0.08);
}
.small{
  padding:8px 10px;
  font-size:13px;
}
.controls{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:space-between;
}
.meta{
  color:var(--muted);
  font-size:13px;
}
.stats{
  display:flex;
  gap:8px;
  align-items:center;
}
.stat{
  background:rgba(255,255,255,0.02);
  padding:8px 10px;
  border-radius:10px;
  font-size:13px;
  color:var(--muted);
}
.right{
  display:flex;
  flex-direction:column;
  gap:12px;
}
.searchbar{
  display:flex;
  gap:10px;
  align-items:center;
}
.toolbar{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:flex-end;
}
.list{
  list-style:none;
  margin:0;
  padding:0;
  max-height:420px;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.item{
  display:flex;
  gap:12px;
  align-items:flex-start;
  padding:12px;
  border-radius:12px;
  background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.006));
  border:1px solid rgba(255,255,255,0.02);
  transition:transform .14s ease, box-shadow .14s ease;
}
.item:hover{transform:translateY(-4px); box-shadow:0 18px 40px rgba(2,6,23,0.45)}
.check{
  width:40px;
  min-width:40px;
  height:40px;
  border-radius:10px;
  display:grid;
  place-items:center;
  font-weight:700;
  font-size:18px;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.03);
  background:transparent;
}
.content{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.task-title{
  font-weight:700;
  font-size:15px;
}
.task-meta{
  color:var(--muted);
  font-size:13px;
  display:flex;
  gap:8px;
  align-items:center;
}
.actions{
  display:flex;
  gap:8px;
  align-items:center;
}
.icon-btn{
  padding:8px;
  border-radius:8px;
  border:0;
  background:transparent;
  color:var(--muted);
  cursor:pointer;
}
.icon-btn:hover{color:#fff}
.badge{
  padding:6px 8px;
  border-radius:999px;
  font-size:12px;
  background:rgba(255,255,255,0.02);
  color:var(--muted);
}
.empty{
  display:grid;
  place-items:center;
  color:var(--muted);
  border-radius:12px;
  padding:40px;
  background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
  border:1px dashed rgba(255,255,255,0.02);
}
.filter-pill{
  padding:8px 10px;
  border-radius:999px;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.02);
  background:transparent;
  color:var(--muted);
}
.filter-pill.active{
  background:linear-gradient(90deg,var(--accent),#7c3aed);
  color:#061226;
  border:0;
  box-shadow:0 8px 24px rgba(99,102,241,0.08);
}
.footer{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  margin-top:auto;
}
@media (max-width:880px){
  .app{grid-template-columns:1fr; padding:16px}
  .left{order:2}
  .right{order:1}
}
</style>
</head>
<body>
<div class="app" role="application" aria-label="Task Manager">
  <div class="left">
    <div class="brand">
      <div class="logo">TM</div>
      <div>
        <div class="title">Task Manager</div>
        <div class="subtitle">CRUD â€¢ Local Storage â€¢ Event Delegation â€¢ Filter</div>
      </div>
    </div>

    <div class="panel">
      <div style="display:flex;flex-direction:column;gap:12px">
        <div style="font-weight:700">Add or edit task</div>
        <div class="form-row">
          <input id="taskInput" class="input" placeholder="Write a task title" aria-label="Task title"/>
        </div>
        <div class="form-row">
          <input id="dueInput" class="input" type="date" aria-label="Due date"/>
        </div>
        <div class="form-row">
          <select id="priority" class="input" aria-label="Priority">
            <option value="low">Low priority</option>
            <option value="medium" selected>Medium priority</option>
            <option value="high">High priority</option>
          </select>
        </div>
        <div style="display:flex;gap:8px">
          <button id="saveBtn" class="btn">Save Task</button>
          <button id="clearBtn" class="btn small" style="background:transparent;color:var(--muted);box-shadow:none;border:1px solid rgba(255,255,255,0.03)">Clear</button>
        </div>
      </div>
    </div>

    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="meta">Quick filters</div>
        <div class="stats">
          <div class="stat" id="totalCount">0 tasks</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
        <button class="filter-pill active" data-filter="all">All</button>
        <button class="filter-pill" data-filter="active">Active</button>
        <button class="filter-pill" data-filter="completed">Completed</button>
        <button class="filter-pill" data-filter="high">High Priority</button>
      </div>
      <div style="margin-top:12px;color:var(--muted);font-size:13px">
        Click a task's check to toggle complete. Use actions to edit or remove. Filtering updates instantly.
      </div>
    </div>

  </div>

  <div class="right">
    <div class="panel" style="display:flex;flex-direction:column;gap:12px">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <div class="meta">Tasks</div>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="search" class="filter" placeholder="Search tasks" aria-label="Search tasks"/>
          <div class="toolbar">
            <button id="clearCompleted" class="btn small" style="background:linear-gradient(180deg,var(--success),#10b981)">Clear Completed</button>
          </div>
        </div>
      </div>

      <ul id="taskList" class="list" aria-live="polite"></ul>

      <div id="emptyState" class="empty" style="display:none">No tasks yet. Add one on the left.</div>

      <div class="footer">
        <div class="meta" id="leftCount">0 left</div>
        <div class="meta" id="lastSaved">â€”</div>
      </div>
    </div>
  </div>
</div>

<script>
const LS_KEY = 'tm.tasks.v1'
let tasks = []
let editingId = null
const el = id=>document.getElementById(id)
const taskInput = el('taskInput')
const dueInput = el('dueInput')
const priority = el('priority')
const saveBtn = el('saveBtn')
const clearBtn = el('clearBtn')
const taskList = el('taskList')
const emptyState = el('emptyState')
const totalCount = el('totalCount')
const leftCount = el('leftCount')
const lastSaved = el('lastSaved')
const search = el('search')
const filterPills = Array.from(document.querySelectorAll('.filter-pill'))

function uid(){
  return Date.now().toString(36) + Math.random().toString(36).slice(2,7)
}

function load(){
  try{
    const raw = localStorage.getItem(LS_KEY)
    tasks = raw ? JSON.parse(raw) : []
  }catch(e){
    tasks = []
  }
}

function save(){
  localStorage.setItem(LS_KEY, JSON.stringify(tasks))
  lastSaved.textContent = 'Saved: ' + new Date().toLocaleTimeString()
}

function render(){
  const q = (search.value || '').trim().toLowerCase()
  const activeFilter = document.querySelector('.filter-pill.active')?.dataset.filter || 'all'
  const filtered = tasks.filter(t=>{
    if(activeFilter==='active') if(t.completed) return false
    if(activeFilter==='completed') if(!t.completed) return false
    if(activeFilter==='high') if(t.priority!=='high') return false
    if(q){
      return t.title.toLowerCase().includes(q) || (t.notes||'').toLowerCase().includes(q)
    }
    return true
  }).sort((a,b)=>{
    if(a.completed!==b.completed) return a.completed?1:-1
    const pr = {high:0, medium:1, low:2}
    if(pr[a.priority] !== pr[b.priority]) return pr[a.priority]-pr[b.priority]
    return new Date(a.due||0) - new Date(b.due||0)
  })

  taskList.innerHTML = ''
  if(filtered.length===0){
    emptyState.style.display = ''
  }else{
    emptyState.style.display = 'none'
    for(const t of filtered){
      const li = document.createElement('li')
      li.className = 'item'
      li.dataset.id = t.id
      li.innerHTML = `
        <button class="check" aria-label="toggle complete">${t.completed? 'âœ“' : ''}</button>
        <div class="content">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div style="display:flex;gap:10px;align-items:center">
              <div class="task-title" ${t.completed? 'style="text-decoration:line-through;color:var(--muted)"' : ''}>${escapeHtml(t.title)}</div>
              <div class="badge">${t.priority}</div>
            </div>
            <div class="task-meta">
              <div class="task-meta">${t.due? new Date(t.due).toLocaleDateString() : ''}</div>
            </div>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <div class="task-meta">${t.completed? 'Completed' : 'Active'} Â· created ${new Date(t.created).toLocaleString()}</div>
            <div class="actions">
              <button class="icon-btn edit" aria-label="edit task">âœŽ</button>
              <button class="icon-btn delete" aria-label="delete task">ðŸ—‘</button>
            </div>
          </div>
        </div>
      `
      taskList.appendChild(li)
    }
  }

  totalCount.textContent = tasks.length + (tasks.length===1? ' task' : ' tasks')
  leftCount.textContent = tasks.filter(t=>!t.completed).length + ' left'
}

function addTask(title, due, pr){
  const t = {id:uid(), title:title.trim(), due: due||'', priority:pr||'medium', completed:false, created: new Date().toISOString()}
  tasks.push(t)
  save()
  render()
  resetForm()
}

function updateTask(id, title, due, pr){
  const t = tasks.find(x=>x.id===id)
  if(!t) return
  t.title = title.trim()
  t.due = due||''
  t.priority = pr
  t.updated = new Date().toISOString()
  save()
  render()
  resetForm()
  editingId = null
  saveBtn.textContent = 'Save Task'
}

function resetForm(){
  taskInput.value = ''
  dueInput.value = ''
  priority.value = 'medium'
  editingId = null
  saveBtn.textContent = 'Save Task'
}

function toggleComplete(id){
  const t = tasks.find(x=>x.id===id)
  if(!t) return
  t.completed = !t.completed
  t.updated = new Date().toISOString()
  save()
  render()
}

function removeTask(id){
  tasks = tasks.filter(x=>x.id!==id)
  save()
  render()
}

function editMode(id){
  const t = tasks.find(x=>x.id===id)
  if(!t) return
  taskInput.value = t.title
  dueInput.value = t.due || ''
  priority.value = t.priority || 'medium'
  editingId = id
  saveBtn.textContent = 'Update Task'
  taskInput.focus()
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g,function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]})
}

taskList.addEventListener('click', (e)=>{
  const li = e.target.closest('.item')
  if(!li) return
  const id = li.dataset.id
  if(e.target.closest('.check')){
    toggleComplete(id)
    return
  }
  if(e.target.closest('.edit')){
    editMode(id)
    return
  }
  if(e.target.closest('.delete')){
    removeTask(id)
    return
  }
})

saveBtn.addEventListener('click', ()=>{
  const title = taskInput.value.trim()
  if(!title) return
  if(editingId) updateTask(editingId, title, dueInput.value, priority.value)
  else addTask(title, dueInput.value, priority.value)
})

clearBtn.addEventListener('click', ()=>{
  resetForm()
})

search.addEventListener('input', render)

filterPills.forEach(p=>{
  p.addEventListener('click', ()=>{
    filterPills.forEach(x=>x.classList.remove('active'))
    p.classList.add('active')
    render()
  })
})

el('clearCompleted').addEventListener('click', ()=>{
  tasks = tasks.filter(t=>!t.completed)
  save()
  render()
})

window.addEventListener('keydown', (e)=>{
  if(e.key==='Enter' && (document.activeElement===taskInput || document.activeElement===dueInput || document.activeElement===priority)){
    saveBtn.click()
  }
})

load()
render()
</script>
</body>
</html>
